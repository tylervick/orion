(function(a,l){typeof exports=="object"&&typeof module<"u"?module.exports=l():typeof define=="function"&&define.amd?define(l):(a=typeof globalThis<"u"?globalThis:a||self,a.Browser=l())})(this,function(){"use strict";const a=e=>typeof e.url=="string"&&typeof e.title=="string"&&(typeof e.favicon=="string"||e.favicon===void 0),d={topSites:{get:async e=>{let o={method:"topSites",payload:e};return window.webkit.messageHandlers.extension.postMessage(o).then(t=>{if(console.log("response",t),Array.isArray(t)&&t.every(a))return t;throw new Error("Invalid response")})}}},p=()=>{window.browser=d,console.debug("Orion Browser API loaded.")},u=(e,o,t,r)=>{window.webkit.messageHandlers.history.postMessage({event:r,href:window.location.href,host:window.location.host,title:o,state:e,url:t})},f=()=>{window.history._pushState=window.history.pushState,window.history._replaceState=window.history.replaceState,window.history.pushState=new Proxy(window.history.pushState,{apply(e,o,t){const[r,n,s]=t;return u(r,n,s,"pushState"),Reflect.apply(e,o,t)}}),window.history.replaceState=new Proxy(window.history.replaceState,{apply(e,o,t){const[r,n,s]=t;return u(r,n,s,"replaceState"),Reflect.apply(e,o,t)}})},w=e=>{var s,i;const o=e.querySelector(".InstallButtonWrapper");if(!o){console.debug("InstallButtonWrapper not found");return}if((s=o.textContent)!=null&&s.includes("Add to Orion")){console.debug('InstallButtonWrapper already contains "Add to Orion"');return}const t=(i=o.querySelector("a.InstallButtonWrapper-download-link"))==null?void 0:i.getAttribute("href");if(!t){console.debug("href not found");return}const r=document.createElement("div");r.className="AMInstallButton AMInstallButton--noDownloadLink";const n=document.createElement("a");n.className="Button Button--action AMInstallButton-button Button--puffy",n.href=t,n.textContent="Add to Orion",r.appendChild(n),o.replaceChildren(r)},c={createHistoryProxy:f,observeInstallButtonWrapper:()=>{window.addEventListener("DOMContentLoaded",()=>{const e=new MutationObserver((t,r)=>{for(const n of t)if(n.type==="childList"){const s=Array.from(n.addedNodes);for(const i of s)i instanceof Element&&i.querySelector(".InstallButtonWrapper")&&w(i)}}),o=document.querySelector("body");o&&e.observe(o,{childList:!0,subtree:!0})})}};return(()=>{c.createHistoryProxy(),c.observeInstallButtonWrapper(),console.debug("Orion Tab API loaded.")})(),p(),d});
